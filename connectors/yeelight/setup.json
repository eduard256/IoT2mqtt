{
    "version": "1.0.0",
    "display_name": "Yeelight",
    "description": "Control Yeelight smart lighting with local network access.",
    "author": "IoT2MQTT",
    "branding": {
        "icon": "/assets/brands/yeelight.svg",
        "color": "#FF7E35",
        "category": "lighting"
    },
    "requirements": {
        "network": "host",
        "python": "3.11",
        "libraries": [
            "yeelight"
        ]
    },
    "tools": {
        "discover_devices": {
            "entry": "actions/discover.py",
            "timeout": 15,
            "network": "local"
        },
        "validate_device": {
            "entry": "actions/validate.py",
            "timeout": 10,
            "network": "local"
        }
    },
    "flows": [
        {
            "id": "manual_entry",
            "name": "Manual",
            "description": "Manually specify device parameters.",
            "default": true,
            "steps": [
                {
                    "id": "device_form",
                    "type": "form",
                    "title": "Device details",
                    "schema": {
                        "fields": [
                            {
                                "type": "text",
                                "name": "friendly_name",
                                "label": "Device name",
                                "placeholder": "Living Room Light",
                                "required": true
                            },
                            {
                                "type": "text",
                                "name": "ip",
                                "label": "IP address",
                                "placeholder": "192.168.1.100",
                                "required": true
                            },
                            {
                                "type": "text",
                                "name": "instance_id",
                                "label": "Instance ID",
                                "placeholder": "auto",
                                "description": "Leave empty to auto-generate unique instance ID",
                                "advanced": true
                            },
                            {
                                "type": "number",
                                "name": "port",
                                "label": "Port",
                                "default": 55443,
                                "advanced": true
                            },
                            {
                                "type": "select",
                                "name": "effect_type",
                                "label": "Transition",
                                "default": "smooth",
                                "advanced": true,
                                "options": [
                                    {
                                        "value": "smooth",
                                        "label": "Smooth"
                                    },
                                    {
                                        "value": "sudden",
                                        "label": "Sudden"
                                    }
                                ]
                            },
                            {
                                "type": "number",
                                "name": "duration",
                                "label": "Transition duration (ms)",
                                "default": 300,
                                "min": 30,
                                "max": 10000,
                                "step": 50,
                                "advanced": true
                            }
                        ]
                    }
                },
                {
                    "id": "validate",
                    "type": "tool",
                    "title": "Validate device",
                    "description": "Verify the device responds before finishing.",
                    "tool": "validate_device",
                    "input": {
                        "host": "{{ form.device_form.ip }}",
                        "port": "{{ form.device_form.port }}",
                        "friendly_name": "{{ form.device_form.friendly_name }}",
                        "instance_id": "{{ form.device_form.instance_id }}",
                        "effect_type": "{{ form.device_form.effect_type }}",
                        "duration": "{{ form.device_form.duration }}"
                    },
                    "auto_advance": true,
                    "optional": true
                },
                {
                    "id": "manual_summary",
                    "type": "summary",
                    "title": "Review",
                    "sections": [
                        {
                            "label": "Device Name",
                            "value": "{{ form.device_form.friendly_name }}"
                        },
                        {
                            "label": "IP Address",
                            "value": "{{ form.device_form.ip }}:{{ form.device_form.port }}"
                        }
                    ]
                },
                {
                    "id": "manual_create",
                    "type": "instance",
                    "instance": {
                        "instance_id": "{{ form.device_form.instance_id }}",
                        "friendly_name": "{{ form.device_form.friendly_name }}",
                        "connector_type": "yeelight",
                        "update_interval": 10,
                        "config": {
                            "discovery_enabled": false,
                            "effect_type": "{{ form.device_form.effect_type }}",
                            "duration": "{{ form.device_form.duration }}"
                        },
                        "devices": [
                            {
                                "device_id": "{{ form.device_form.friendly_name }}",
                                "ip": "{{ form.device_form.ip }}",
                                "port": "{{ form.device_form.port }}",
                                "name": "{{ form.device_form.friendly_name }}",
                                "enabled": true
                            }
                        ]
                    }
                }
            ]
        }
    ]
}
